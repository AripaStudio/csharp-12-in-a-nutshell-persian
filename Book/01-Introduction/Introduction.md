## آشنایی با سی‌شارپ و دات‌نت

سی‌شارپ یک زبان برنامه‌نویسی همه‌منظوره، با امنیت نوع (type-safe) و شی‌ءگرا است. هدف این زبان، افزایش بهره‌وری برنامه‌نویسان است. بدین منظور، سی‌شارپ بین سادگی، گویایی و عملکرد، تعادل ایجاد می‌کند. معمار اصلی این زبان از اولین نسخه آن، آندرس هجسلبرگ (خالق توربو پاسکال و معمار دلفی) بوده است.

زبان سی‌شارپ مستقل از بستر (platform neutral) است و با طیف وسیعی از محیط‌های اجرایی (runtimes) مختص هر بستر کار می‌کند.

## شی‌ءگرایی

سی‌شارپ یک پیاده‌سازی غنی از پارادایم شی‌ءگرایی است که شامل کپسوله‌سازی (encapsulation)، وراثت (inheritance) و چندریختی (polymorphism) می‌شود. کپسوله‌سازی به معنای ایجاد یک مرز در اطراف یک شیء برای جدا کردن رفتار بیرونی (عمومی) آن از جزئیات پیاده‌سازی داخلی (خصوصی) است. در ادامه، ویژگی‌های متمایز سی‌شارپ از منظر شی‌ءگرایی آمده است:

سامانه نوع یکپارچه:
بلوک ساختاری اساسی در سی‌شارپ، یک واحد کپسوله‌شده از داده‌ها و توابع است که نوع نامیده می‌شود. سی‌شارپ دارای یک سامانه نوع یکپارچه است که در آن همه انواع، در نهایت یک نوع پایه مشترک دارند. این بدان معناست که همه انواع، چه نشان‌دهنده اشیاء کسب‌وکار باشند و چه انواع اولیه مانند اعداد، از همان عملکرد پایه مشترک برخوردارند. به عنوان مثال، یک نمونه از هر نوع را می‌توان با فراخوانی متد تبدیل به رشته (ToString) آن، به رشته تبدیل کرد.

کلاس‌ها و رابط‌ها:
در یک پارادایم سنتی شی‌ءگرا، تنها نوع موجود، کلاس است. در سی‌شارپ، چندین نوع دیگر نیز وجود دارد که یکی از آن‌ها رابط است. رابط مانند کلاسی است که نمی‌تواند داده نگه دارد. این بدان معناست که تنها می‌تواند رفتار را تعریف کند (و نه وضعیت را)، که امکان وراثت چندگانه و همچنین جدایی بین مشخصات و پیاده‌سازی را فراهم می‌کند.

خصوصیات، متدها و رویدادها:
در پارادایم شی‌ءگرای محض، همه توابع، متد هستند. در سی‌شارپ، متدها تنها یکی از انواع اعضای تابع هستند که شامل خصوصیات (properties) و رویدادها (events) نیز می‌شوند (انواع دیگری هم وجود دارند). خصوصیات، اعضای تابعی هستند که بخشی از وضعیت یک شیء را کپسوله‌سازی می‌کنند، مانند رنگ یک دکمه یا متن یک برچسب. رویدادها نیز اعضای تابعی هستند که ساده‌سازی واکنش به تغییرات وضعیت شیء را به عهده دارند.

اگرچه سی‌شارپ در درجه اول یک زبان شی‌ءگرا است، اما از پارادایم برنامه‌نویسی تابعی نیز الهام گرفته است، به ویژه در موارد زیر:

توابع را می‌توان به عنوان مقادیر در نظر گرفت:
با استفاده از نمایندگان (delegates)، سی‌شارپ اجازه می‌دهد تا توابع به عنوان مقادیر به توابع دیگر فرستاده و از آن‌ها بازگردانده شوند.

سی‌شارپ از الگوهایی برای پاکی پشتیبانی می‌کند:
هسته اصلی برنامه‌نویسی تابعی، پرهیز از استفاده از متغیرهایی است که مقادیرشان تغییر می‌کند، به نفع الگوهای اعلانی. سی‌شارپ ویژگی‌های کلیدی برای کمک به این الگوها دارد، از جمله توانایی نوشتن توابع بی‌نام به صورت لحظه‌ای که متغیرها را "شکار" می‌کنند (عبارات لامبدا) و توانایی انجام برنامه‌نویسی لیست یا واکنشی از طریق عبارات پرس‌وجو. سی‌شارپ همچنین سوابق (records) را فراهم می‌کند که نوشتن انواع تغییرناپذیر (فقط خواندنی) را آسان می‌کند.

## امنیت نوع

سی‌شارپ در درجه اول یک زبان با امنیت نوع است، به این معنی که نمونه‌های انواع تنها می‌توانند از طریق پروتکل‌هایی که تعریف می‌کنند با یکدیگر تعامل داشته باشند، که این امر سازگاری داخلی هر نوع را تضمین می‌کند. به عنوان مثال، سی‌شارپ شما را از تعامل با یک نوع رشته به گونه‌ای که گویی یک نوع عدد صحیح است، باز می‌دارد.

به طور خاص‌تر، سی‌شارپ از تایپ ایستا (Static Typing) پشتیبانی می‌کند، به این معنی که زبان، امنیت نوع را در زمان کامپایل (Compile Time) اعمال می‌کند. این علاوه بر امنیت نوع است که در زمان اجرا (Runtime) نیز اعمال می‌شود. تایپ ایستا بخش بزرگی از خطاها را قبل از اجرای برنامه از بین می‌برد. بار بررسی صحت مطابقت انواع در یک برنامه را از آزمون‌های واحد زمان اجرا به کامپایلر منتقل می‌کند. این باعث می‌شود مدیریت برنامه‌های بزرگ بسیار آسان‌تر، قابل پیش‌بینی‌تر و مقاوم‌تر شود. علاوه بر این، تایپ ایستا به ابزارهایی مانند IntelliSense در ویژوال استودیو امکان می‌دهد تا به شما در نوشتن برنامه کمک کنند، زیرا برای یک متغیر مشخص، نوع آن را می‌داند و در نتیجه می‌داند چه متدهایی را می‌توانید روی آن متغیر فراخوانی کنید. چنین ابزارهایی همچنین می‌توانند هر جایی از برنامه شما که یک متغیر، نوع یا متد استفاده شده است را شناسایی کرده و امکان بازسازی (Refactoring) قابل اعتماد را فراهم کنند.

سی‌شارپ همچنین اجازه می‌دهد بخش‌هایی از کد شما از طریق کلمه کلیدی پویا (dynamic) به صورت پویا تایپ شوند. با این حال، سی‌شارپ همچنان یک زبان عمدتاً با تایپ ایستا باقی می‌ماند.

سی‌شارپ همچنین یک زبان قوی‌تایپ (Strongly Typed) نامیده می‌شود، زیرا قوانین نوع آن به شدت اعمال می‌شوند (چه به صورت ایستا و چه در زمان اجرا). به عنوان مثال، نمی‌توانید تابعی را که برای پذیرش یک عدد صحیح طراحی شده است، با یک عدد اعشاری فراخوانی کنید، مگر اینکه ابتدا به صراحت عدد اعشاری را به عدد صحیح تبدیل کنید. این به جلوگیری از اشتباهات کمک می‌کند.

## مدیریت حافظه

سی‌شارپ برای انجام مدیریت خودکار حافظه، به محیط زمان اجرا (runtime) متکی است. محیط زمان اجرای مشترک (Common Language Runtime) دارای یک جمع‌آوری‌کننده زباله (garbage collector) است که به عنوان بخشی از برنامه شما اجرا می‌شود و حافظه اشیائی را که دیگر به آن‌ها ارجاعی داده نمی‌شود، بازپس می‌گیرد. این کار برنامه‌نویسان را از آزادسازی صریح حافظه برای یک شیء رها می‌کند و مشکل اشاره‌گرهای نادرست که در زبان‌هایی مانند سی‌پلاس‌پلاس با آن‌ها مواجه می‌شدیم، از بین می‌برد.

سی‌شارپ اشاره‌گرها را به طور کامل حذف نمی‌کند: صرفاً آن‌ها را برای بیشتر وظایف برنامه‌نویسی غیرضروری می‌سازد. برای نقاط حساس به عملکرد (performance-critical hotspots) و تعامل‌پذیری (interoperability)، استفاده از اشاره‌گرها و تخصیص صریح حافظه در بلوک‌هایی که با عنوان "ناامن" (unsafe) علامت‌گذاری شده‌اند، مجاز است.

## پشتیبانی از بسترها

سی‌شارپ دارای محیط‌های اجرایی است که از بسترهای زیر پشتیبانی می‌کنند:

رومیزی ویندوز ۷ به بالا (برای برنامه‌های مشتری غنی، وب، سرور و خط فرمان)
سیستم‌عامل مک (برای برنامه‌های وب و خط فرمان – و برنامه‌های مشتری غنی از طریق مک کاتالیست)
لینوکس (برای برنامه‌های وب و خط فرمان)
اندروید و آی‌او‌اس (برای برنامه‌های موبایل)
دستگاه‌های ویندوز ۱۰ (ایکس‌باکس، سرفیس هاب و هولولنز) از طریق سکوی برنامه‌نویسی جهانی ویندوز (UWP)
همچنین فناوری‌ای به نام بلِیْزر وجود دارد که می‌تواند سی‌شارپ را به اسمبلیکد وب (web assembly) کامپایل کند که در مرورگر اجرا می‌شود.

## محیط‌های زمان اجرا (CLRs)، کتابخانه‌های کلاس پایه (BCLs) و رانتایم‌ها

پشتیبانی محیط زمان اجرا برای برنامه‌های سی‌شارپ شامل یک محیط زمان اجرای مشترک و یک کتابخانه کلاس پایه است. یک محیط زمان اجرا همچنین می‌تواند شامل یک لایه کاربردی سطح بالاتر باشد که شامل کتابخانه‌هایی برای توسعه برنامه‌های مشتری غنی، موبایل یا وب است (به تصویر ۱-۱ مراجعه کنید). محیط‌های زمان اجرای مختلف برای انواع مختلفی از برنامه‌ها و همچنین بسترهای متفاوت وجود دارند.

<div align="center">
  
  ![Conventions-UsedThis-Book](../../assets/image/Runtime-architecture.png) 
  
</div>

## محیط زمان اجرای مشترک

یک محیط زمان اجرای مشترک (CLR) خدمات اساسی زمان اجرا را فراهم می‌کند، از جمله مدیریت خودکار حافظه و رسیدگی به خطاها. (کلمه "مشترک" به این واقعیت اشاره دارد که همین محیط زمان اجرا می‌تواند توسط سایر زبان‌های برنامه‌نویسی مدیریت شده، مانند اف‌شارپ، ویژوال بیسیک، و سی‌پلاس‌پلاس مدیریت شده، به اشتراک گذاشته شود.)

سی‌شارپ یک زبان "مدیریت شده" نامیده می‌شود، زیرا کد منبع را به کد مدیریت شده (managed code) کامپایل می‌کند که در قالب زبان میانی (Intermediate Language - IL) نمایش داده می‌شود. محیط زمان اجرای مشترک (CLR) زبان میانی را به کد بومی ماشین (native code)، مانند X64 یا X86، معمولاً دقیقاً قبل از اجرا تبدیل می‌کند. به این فرآیند کامپایل در لحظه (Just-In-Time - JIT) گفته می‌شود. کامپایل پیش از زمان اجرا (Ahead-of-Time compilation) نیز برای بهبود زمان راه‌اندازی با مجموعه‌های بزرگ یا دستگاه‌های با منابع محدود (و برای رعایت قوانین فروشگاه برنامه‌های آی‌او‌اس هنگام توسعه برنامه‌های موبایل) در دسترس است.

ظرف حاوی کد مدیریت شده، مجموعه (Assembly) نامیده می‌شود. یک مجموعه نه تنها شامل زبان میانی، بلکه شامل اطلاعات نوع (metadata) نیز هست. وجود اطلاعات نوع به مجموعه‌ها اجازه می‌دهد تا به انواع موجود در سایر مجموعه‌ها بدون نیاز به فایل‌های اضافی ارجاع دهند.

شما می‌توانید محتویات یک مجموعه را با ابزار ildasm مایکروسافت بررسی و جداسازی (disassemble) کنید. و با ابزارهایی مانند ILSpy یا JetBrains dotPeek، می‌توانید فراتر رفته و زبان میانی را به سی‌شارپ دیکامپایل (decompile) کنید. از آنجا که زبان میانی سطح بالاتری نسبت به کد بومی ماشین دارد، ابزارهای دیکامپایلر می‌توانند کار بسیار خوبی در بازسازی سی‌شارپ اصلی انجام دهند.

یک برنامه می‌تواند اطلاعات نوع خودش را پرس‌وجو کند (بازتاب - reflection) و حتی در زمان اجرا، زبان میانی جدیدی تولید کند (reflection.emit).

## کتابخانه کلاس پایه

یک محیط زمان اجرای مشترک (CLR) همیشه همراه با مجموعه‌ای از کتابخانه‌ها عرضه می‌شود که کتابخانه کلاس پایه (Base Class Library - BCL) نامیده می‌شوند. یک کتابخانه کلاس پایه، قابلیت‌های اصلی را به برنامه‌نویسان ارائه می‌دهد، مانند مجموعه‌ها (collections)، ورودی/خروجی، پردازش متن، مدیریت XML/JSON، شبکه‌سازی، رمزنگاری، تعامل‌پذیری (interop)، همروندی (concurrency) و برنامه‌نویسی موازی.

یک کتابخانه کلاس پایه همچنین انواعی را که خود زبان سی‌شارپ نیاز دارد (برای ویژگی‌هایی مانند شمارش، پرس‌وجو و ناهمگامی) پیاده‌سازی می‌کند و به شما امکان می‌دهد مستقیماً به ویژگی‌های محیط زمان اجرای مشترک (CLR)، مانند بازتاب و مدیریت حافظه، دسترسی پیدا کنید.

## محیط‌های اجرایی

یک محیط اجرایی (runtime) (که گاهی اوقات "چارچوب" (framework) نیز نامیده می‌شود) یک واحد قابل استقرار است که آن را دانلود و نصب می‌کنید. یک محیط اجرایی از یک محیط زمان اجرای مشترک (CLR) (همراه با کتابخانه کلاس پایه آن) به علاوه یک لایه کاربردی اختیاری خاص برای نوع برنامه‌ای که می‌نویسید – وب، موبایل، مشتری غنی و غیره – تشکیل شده است. (اگر در حال نوشتن یک برنامه کنسولی خط فرمان یا یک کتابخانه بدون رابط کاربری هستید، نیازی به لایه کاربردی ندارید.)

هنگام نوشتن یک برنامه، شما یک محیط اجرایی خاص را هدف قرار می‌دهید، به این معنی که برنامه شما از قابلیت‌هایی که آن محیط اجرایی فراهم می‌کند، استفاده می‌کند و به آن‌ها وابسته است. انتخاب محیط اجرایی شما همچنین تعیین می‌کند که برنامه شما از کدام بسترها پشتیبانی خواهد کرد.

جدول زیر گزینه‌های اصلی محیط‌های اجرایی را فهرست می‌کند:

